angular.module("frontend42",["ui.tree"]),angular.module("frontend42").controller("ChangePageTypeController",["$scope","$attrs","$modal","$window",function($scope,$attrs,$modal,$window){$scope.change=function(){var modalInstance=$modal.open({animation:!0,templateUrl:"changePageTypeModal.html",controller:"ChangePageTypeModalController",size:"lg",resolve:{changeUrl:function(){return $attrs.changeUrl}}});modalInstance.result.then(function(data){$window.location.href=data.redirect},function(){})}}]),angular.module("frontend42").controller("ChangePageTypeModalController",["$scope","$modalInstance","$http","changeUrl",function($scope,$modalInstance,$http,changeUrl){$scope.ok=function(){$http({method:"POST",url:changeUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{page_type:$scope.formElement.page_type_selector},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")}}).success(function(data){$modalInstance.close(data)}).error(function(){})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("frontend42").controller("PageSelectorController",["$scope","$attrs","jsonCache",function($scope,$attrs,jsonCache){$scope.page={},$scope.locale=$attrs.activeLocale,$scope.pages=jsonCache.get($attrs.jsonDataId)[$scope.locale],$scope.changeLocale=function(){$scope.pages=jsonCache.get($attrs.jsonDataId)[$scope.locale],$scope.page={}}}]),angular.module("frontend42").controller("SitemapController",["$scope","$http","$attrs","$modal","$window",function($scope,$http,$attrs,$modal,$window){$scope.isLoading=!0,$scope.showOnline=!0,$scope.showOffline=!0,$scope.locale=$attrs.activeLocale;var requestUrl=$attrs.requestUrl,saveUrl=$attrs.saveUrl,loadTree=function(){$scope.isLoading=!0;var options={showOnline:$scope.showOnline,showOffline:$scope.showOffline,locale:$scope.locale};$http.post(requestUrl,options).success(function(data){$scope.sitemap=data,$scope.isLoading=!1}).error(function(){$scope.sitemap=[],$scope.isLoading=!1})};$scope.loadTree=loadTree;var saveTree=function(){$scope.isLoading=!0,$http.post(saveUrl,$scope.sitemap).success(function(){$scope.isLoading=!1}).error(function(){loadTree()})};$scope.treeOptions={accept:function(sourceNodeScope,destNodesScope){var parent=destNodesScope.$parent;return angular.isUndefined(parent.$modelValue)?!0:angular.isUndefined(parent.$modelValue.droppable)?!0:parent.$modelValue.droppable},dropped:function(){if(0!=$scope.sitemap.length){var modalInstance=$modal.open({animation:!0,templateUrl:"sortModalContent.html",controller:"ModalController",size:"lg"});modalInstance.result.then(function(){saveTree()},function(){loadTree()})}}},$scope.sitemap=[],loadTree(),$scope.addPage=function(){var modalInstance=$modal.open({animation:!0,templateUrl:"addPageModalContent.html",controller:"AddPageModalController",size:"lg",resolve:{addSitemapUrl:function(){return $attrs.addUrl}}});modalInstance.result.then(function(data){angular.isDefined(data.url)&&($window.location.href=data.url)},function(){})},$scope.deleteCallback=function(){loadTree()}}]),angular.module("frontend42").controller("AddPageModalController",["$scope","$modalInstance","$http","addSitemapUrl",function($scope,$modalInstance,$http,addSitemapUrl){$scope.ok=function(){$http({method:"POST",url:addSitemapUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{page_selector:$scope.formElement.page_selector,page_type_selector:$scope.formElement.page_type_selector,name:$scope.formElement.name},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")}}).success(function(data){$modalInstance.close(data)}).error(function(){})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]);