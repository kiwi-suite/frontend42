angular.module("frontend42",["ui.tree"]),angular.module("frontend42").controller("BlockAnchorController",["$scope","$attrs","$modal","jsonCache","$http",function($scope,$attrs,$modal,jsonCache,$http){$scope.inheritanceInfo=jsonCache.get($attrs.jsonDataId),$scope.saveAnchor=function(sitemapUrl,saveAnchorUrl,section,pageId){var modalInstance=$modal.open({animation:!0,templateUrl:"saveBlockAnchorModal.html",controller:"SaveBlockAnchorModalController",size:"lg",resolve:{saveAnchorUrl:function(){return saveAnchorUrl},sitemapUrl:function(){return sitemapUrl},section:function(){return section},pageId:function(){return pageId}}});modalInstance.result.then(function(data){$scope.inheritanceInfo=data},function(){$scope.inheritanceInfo=null})},$scope.cleanAnchor=function(cleanAnchorUrl,section,pageId){$http({method:"POST",url:cleanAnchorUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{sourcePageId:pageId,section:section},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")}}).success(function(){$scope.inheritanceInfo=null}).error(function(){$scope.inheritanceInfo=null})}}]),angular.module("frontend42").controller("SaveBlockAnchorModalController",["$scope","$modalInstance","$http","saveAnchorUrl","sitemapUrl","pageId","section",function($scope,$modalInstance,$http,saveAnchorUrl,sitemapUrl,pageId,section){$scope.targetPageId=0;var loadTree=function(){$scope.isLoading=!0,$http.post(sitemapUrl,{pageId:pageId,section:section}).success(function(data){$scope.sitemap=data,$scope.isLoading=!1}).error(function(){$scope.sitemap=[],$scope.isLoading=!1})};$scope.sitemap=[],loadTree(),$scope.selectableStyle=function(item){return $scope.targetPageId==item.pageId?{"background-color":"#9DC482",color:"#000",cursor:"pointer"}:1==item.selectable?{cursor:"pointer"}:{"background-color":"#f6f8f8",color:"#ccc"}},$scope.select=function(item){item.selectable!==!1&&($scope.targetPageId=item.pageId)},$scope.ok=function(){0!==$scope.targetPageId&&$http({method:"POST",url:saveAnchorUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{targetPageId:$scope.targetPageId,sourcePageId:pageId,section:section},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")}}).success(function(data){$modalInstance.close(data)}).error(function(){})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("frontend42").controller("ChangePageTypeController",["$scope","$attrs","$modal","$window",function($scope,$attrs,$modal,$window){$scope.change=function(){var modalInstance=$modal.open({animation:!0,templateUrl:"changePageTypeModal.html",controller:"ChangePageTypeModalController",size:"lg",resolve:{changeUrl:function(){return $attrs.changeUrl}}});modalInstance.result.then(function(data){angular.isDefined(data.redirect)&&($window.location.href=data.redirect)},function(){})}}]),angular.module("frontend42").controller("ChangePageTypeModalController",["$scope","$modalInstance","$http","changeUrl",function($scope,$modalInstance,$http,changeUrl){$scope.ok=function(){$http({method:"POST",url:changeUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{page_type:$scope.formElement.page_type_selector},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")}}).success(function(data){$modalInstance.close(data)}).error(function(){})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("frontend42").controller("FlatController",["$scope","$http","$attrs","$modal","$window",function($scope,$http,$attrs,$modal,$window){$scope.addPage=function(){var modalInstance=$modal.open({animation:!0,templateUrl:"addFlatModalContent.html",controller:"AddFlatModalController",size:"lg",resolve:{addSitemapUrl:function(){return $attrs.addUrl},locale:function(){return $scope.flat.locale}}});modalInstance.result.then(function(data){angular.isDefined(data.url)&&($window.location.href=data.url)},function(){})}}]),angular.module("frontend42").controller("AddFlatModalController",["$scope","$modalInstance","$http","addSitemapUrl","locale",function($scope,$modalInstance,$http,addSitemapUrl,locale){$scope.ok=function(){$http({method:"POST",url:addSitemapUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{locale:locale,name:$scope.formElement.name},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")}}).success(function(data){$modalInstance.close(data)}).error(function(){})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("frontend42").controller("LinkSitemapController",["$scope","$attrs","$http",function($scope,$attrs,$http){$scope.selectedPage=0,$scope.locale=$attrs.activeLocale,$scope.query="";var inititalValue=$scope.link.getValue();null!=inititalValue&&($scope.selectedPage=inititalValue.id,$scope.locale=inititalValue.locale);var loadTree=function(){$scope.isLoading=!0,$http.post($attrs.requestUrl,{locale:$scope.locale}).success(function(data){$scope.sitemap=data,$scope.isLoading=!1}).error(function(){$scope.sitemap=[],$scope.isLoading=!1})};$scope.sitemap=[],$scope.loadTree=loadTree,loadTree(),$scope.visible=function(item){if(!$scope.query||0==$scope.query.length)return!0;if(item.title.toLowerCase().indexOf($scope.query.toLowerCase())>-1)return!0;if(item.items.length>0)for(var i=0,len=item.items.length;len>i;i++)if(1==$scope.visible(item.items[i]))return!0;return!1},$scope.findNodes=function(){},$scope.selectableStyle=function(item){return $scope.selectedPage==item.pageId?{"background-color":"#9DC482",color:"#000",cursor:"pointer"}:{cursor:"pointer"}},$scope.select=function(item){$scope.selectedPage=item.pageId,$scope.link.setValue({id:$scope.selectedPage,locale:$scope.locale})}}]),angular.module("frontend42").controller("PageSelectorController",["$scope","$attrs","jsonCache",function($scope,$attrs,jsonCache){$scope.page={},$scope.locale=$attrs.activeLocale,$scope.pages=jsonCache.get($attrs.jsonDataId)[$scope.locale],$scope.changeLocale=function(){$scope.pages=jsonCache.get($attrs.jsonDataId)[$scope.locale],$scope.page={}}}]),angular.module("frontend42").controller("SitemapController",["$scope","$http","$attrs","$modal","$window",function($scope,$http,$attrs,$modal,$window){$scope.isLoading=!0,$scope.showOnline=!0,$scope.showOffline=!0,$scope.locale=$attrs.activeLocale,$scope.query="";var requestUrl=$attrs.requestUrl,saveUrl=$attrs.saveUrl,loadTree=function(){$scope.isLoading=!0;var options={showOnline:$scope.showOnline,showOffline:$scope.showOffline,locale:$scope.locale};$http.post(requestUrl,options).success(function(data){$scope.sitemap=data,$scope.isLoading=!1}).error(function(){$scope.sitemap=[],$scope.isLoading=!1})};$scope.loadTree=loadTree;var saveTree=function(){$scope.isLoading=!0,$http.post(saveUrl,$scope.sitemap).success(function(){$scope.isLoading=!1}).error(function(){loadTree()})};$scope.visible=function(item){if(!$scope.query||0==$scope.query.length)return!0;if(item.title.toLowerCase().indexOf($scope.query.toLowerCase())>-1)return!0;if(item.items.length>0)for(var i=0,len=item.items.length;len>i;i++)if(1==$scope.visible(item.items[i]))return!0;return!1},$scope.findNodes=function(){},$scope.treeOptions={accept:function(sourceNodeScope,destNodesScope){var parent=destNodesScope.$parent;return angular.isUndefined(parent.$modelValue)?!0:angular.isUndefined(parent.$modelValue.droppable)?!0:parent.$modelValue.droppable},dropped:function(){if(0!=$scope.sitemap.length){var modalInstance=$modal.open({animation:!0,templateUrl:"sortModalContent.html",controller:"ModalController",size:"lg"});modalInstance.result.then(function(){saveTree()},function(){loadTree()})}}},$scope.sitemap=[],loadTree(),$scope.addSubPage=function(parentId){var modalInstance=$modal.open({animation:!0,templateUrl:"addSubPageModalContent.html",controller:"AddPageModalController",size:"lg",resolve:{addSitemapUrl:function(){return $attrs.addUrl},parentId:function(){return parentId}}});modalInstance.result.then(function(data){angular.isDefined(data.url)&&($window.location.href=data.url)},function(){})},$scope.addPage=function(){var modalInstance=$modal.open({animation:!0,templateUrl:"addPageModalContent.html",controller:"AddPageModalController",size:"lg",resolve:{addSitemapUrl:function(){return $attrs.addUrl},parentId:function(){return null}}});modalInstance.result.then(function(data){angular.isDefined(data.url)&&($window.location.href=data.url)},function(){})},$scope.deleteCallback=function(){loadTree()}}]),angular.module("frontend42").controller("AddPageModalController",["$scope","$modalInstance","$http","addSitemapUrl","parentId",function($scope,$modalInstance,$http,addSitemapUrl,parentId){$scope.ok=function(){null!==parentId||(parentId=$scope.formElement.page_selector),$http({method:"POST",url:addSitemapUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{page_selector:parentId,page_type_selector:$scope.formElement.page_type_selector,name:$scope.formElement.name},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")}}).success(function(data){$modalInstance.close(data)}).error(function(){})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]);