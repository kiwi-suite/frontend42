<div class="wrapper-md bg-white b-b box-shadow">
    <h1 class="m-n font-thin h3">
        <span class="fa fa-sitemap"></span>
        <?= $this->translate('title.sitemap', 'admin') ?>
    </h1>
</div>

<div class="wrapper-md"
     data-request-url="<?= $this->url('admin/sitemap/list')?>"
     data-save-url="<?= $this->url('admin/sitemap/save')?>"
     data-add-url="<?= $this->url('admin/sitemap/add-sitemap')?>"
     ng-controller="SitemapController"
     data-active-locale="<?= $this->localization()->getDefaultLocale() ?>"
    >
    <div class="panel panel-default">
        <div class="panel-heading">
            <div class="row">
                <div class="col-md-3 col-md-offset-9">
                    <select ng-model="locale" class="form-control" ng-change="loadTree()">
                        <?php foreach($this->localization()->getAvailableLocalesDisplay() as $_locale => $_name): ?>
                            <option value="<?= $_locale?>"><?= $_name ?></option>
                        <?php endforeach; ?>
                    </select>
                </div>
            </div>
        </div>
        <div class="panel-body">
            <script type="text/ng-template" id="nodes_renderer.html">
                <div class="dd-handle dd3-handle" ui-tree-handle>&nbsp;</div>
                <div class="dd3-content">
                    <div class="row">
                        <div class="col-md-8">
                            <a class="btn btn-link btn-xs" ng-click="toggle(this)">
                                <span class="glyphicon" ng-class="{'glyphicon-chevron-right': collapsed, 'glyphicon-chevron-down': !collapsed}"></span>
                            </a>
                            <code>#{{item.id}}</code> {{item.title}}
                        </div>
                        <div class="col-md-1 text-center">
                            <span class="label" ng-class="{'label-success': item.status == 'online', 'label-danger': item.status == 'offline'}">{{ item.status }}</span>
                        </div>
                        <div class="col-md-1 text-center">
                            <span class="label label-default">{{ item.viewCount }}</span>
                        </div>
                        <div class="col-md-1 text-center">
                            <span class="label label-default">{{ item.pageType }}</span>
                        </div>
                        <div class="col-md-1 text-right">
                            <a class="btn btn-info btn-sm" ng-href="<?= $this->url('admin/sitemap/edit', ['id' => '{{ item.id }}']) ?>">
                                <span class="fa fa-pencil"></span>
                                <?= $this->translate('button.edit', 'admin') ?>
                            </a>
                        </div>
                    </div>
                </div>
                <ol class="dd-list" ui-tree-nodes="" ng-model="item.items" ng-class="{hidden: collapsed}">
                    <li class="dd-item dd3-item" ng-repeat="item in item.items" ui-tree-node ng-include="'nodes_renderer.html'"></li>
                </ol>
            </script>
            <div ng-show="isLoading" class="angular-ui-tree-loading text-center">
                <i class="fa fa-spin fa-refresh"></i>
            </div>
            <div ng-hide="isLoading" class="dd" ui-tree="treeOptions">
                <ol class="dd-list" ui-tree-nodes="" ng-model="sitemap" id="tree-root">
                    <li class="dd-item dd3-item" ng-repeat="item in sitemap" ui-tree-node ng-include="'nodes_renderer.html'"></li>
                </ol>
            </div>
        </div>
        <div class="panel-footer">
            <a class="btn btn-default" ng-click="addPage()">
                <span class="fa fa-plus-circle"></span>
                <?= $this->translate('button.page-add', 'admin') ?>
            </a>
        </div>
    </div>
</div>
<script type="text/ng-template" id="sortModalContent.html">
    <div class="modal-header">
        <h3 class="modal-title"><?= $this->translate('modal.sitemap.sorting-title', 'admin') ?></h3>
    </div>
    <div class="modal-body">
        <?= $this->translate('modal.sitemap.sorting-warning', 'admin') ?>
        <?php if (count($this->localization()->getAvailableLocales()) > 1): ?>
            <br><br>
            <em><?= $this->translate('modal.sitemap.sorting-lang-warning', 'admin') ?></em>
        <?php endif; ?>

    </div>
    <div class="modal-footer">
        <button class="btn btn-success" ng-click="ok()"><?= $this->translate('button.save', 'admin') ?></button>
        <button class="btn btn-default" ng-click="cancel()"><?= $this->translate('button.cancel', 'admin') ?></button>
    </div>
</script>

<script type="text/ng-template" id="addPageModalContent.html">
    <div class="modal-header">
        <h3 class="modal-title">Add Page</h3>
    </div>
    <div class="modal-body">
        <div class="container-fluid">
            <form class="form-horizontal" role="form">
                <?= $this->form($this->createForm) ?>
            </form>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-success" ng-click="ok()">
            <span class="fa fa-plus-circle"></span>
            <?= $this->translate('button.page-add', 'admin') ?>
        </button>
        <button class="btn btn-default" ng-click="cancel()"><?= $this->translate('button.cancel', 'admin') ?></button>
    </div>
</script>
